<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoTrack - Carbon Footprint Tracker</title>
    <!-- Google Fonts for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #10b981; /* Emerald Green */
            --primary-dark: #059669;
            --secondary-color: #3b82f6; /* Blue */
            --accent-color: #f59e0b; /* Amber/Yellow */
            --danger-color: #ef4444; /* Red */
            --text-main: #1f2937;
            --text-secondary: #6b7280;
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --border-color: #e5e7eb;
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* --- Sidebar Navigation --- */
        .sidebar {
            width: 260px;
            background-color: var(--bg-card);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            position: fixed;
            height: 100%;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 2.5rem;
        }

        .nav-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background-color: #f0fdf4;
            color: var(--primary-color);
        }

        .nav-item.active {
            background-color: #ecfdf5;
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
            max-width: 1400px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title h1 {
            font-size: 1.75rem;
            color: var(--text-main);
        }

        .page-title p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e5e7eb;
            object-fit: cover;
        }

        /* --- Sections & Grid --- */
        .section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* --- Cards --- */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .stat-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 140px;
        }

        .stat-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 0.5rem 0;
        }

        .stat-sub {
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trend-down { color: var(--primary-color); }
        .trend-up { color: var(--danger-color); }
        .trend-neutral { color: var(--accent-color); }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background-color: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
        }

        /* --- Recommendations (Screenshot 2) --- */
        .split-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .rec-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .rec-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: transform 0.2s;
        }

        .rec-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .rec-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rec-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .rec-high { background-color: #ecfdf5; color: var(--primary-color); }
        .rec-med { background-color: #fffbeb; color: var(--accent-color); }
        .rec-low { background-color: #eff6ff; color: var(--secondary-color); }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .badge-high { background-color: #ecfdf5; color: var(--primary-color); border: 1px solid #a7f3d0; }
        .badge-med { background-color: #fffbeb; color: var(--accent-color); border: 1px solid #fde68a; }
        .badge-low { background-color: #eff6ff; color: var(--secondary-color); border: 1px solid #bfdbfe; }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .cat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cat-info h4 { font-size: 0.9rem; margin-bottom: 4px; }
        .cat-info span { font-size: 0.8rem; color: var(--text-secondary); }

        /* --- Transactions (Screenshot 3) --- */
        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .transaction-table th {
            text-align: left;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .transaction-table td {
            padding: 1rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .t-merchant { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .t-category { font-size: 0.8rem; color: var(--text-secondary); }
        .t-co2 { font-weight: 600; color: var(--text-main); display: flex; align-items: center; gap: 4px; }
        .co2-high { color: var(--danger-color); background: #fef2f2; padding: 2px 8px; border-radius: 12px; }
        .co2-med { color: var(--accent-color); background: #fffbeb; padding: 2px 8px; border-radius: 12px; }
        .co2-low { color: var(--primary-color); background: #ecfdf5; padding: 2px 8px; border-radius: 12px; }

        /* --- Insights (Screenshot 4 & 5) --- */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .impact-card {
            text-align: center;
            padding: 2rem;
        }

        .tree-visual {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .badges-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
            justify-content: center;
        }

        .badge-achievement {
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: var(--radius-md);
            width: 140px;
            text-align: center;
            opacity: 1;
            transition: all 0.3s;
        }

        .badge-achievement.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .badge-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .trend-chart {
            margin-top: 2rem;
        }
        
        .chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .chart-label { width: 50px; font-size: 0.85rem; color: var(--text-secondary); }
        .chart-bar-bg { flex: 1; height: 10px; background: #f3f4f6; border-radius: 5px; margin: 0 10px; overflow: hidden; }
        .chart-bar-fill { height: 100%; background: var(--primary-color); border-radius: 5px; }
        .chart-value { width: 40px; font-size: 0.85rem; font-weight: 600; text-align: right; }

        /* --- Mobile Responsiveness --- */
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
            .split-layout { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); width: 240px; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1rem; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .menu-toggle { display: block; }
        }
        
        .menu-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-main);
            margin-right: 1rem;
        }

        @media (min-width: 769px) {
            .menu-toggle { display: none; }
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fa-solid fa-leaf"></i> EcoTrack
        </div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="switchTab('dashboard')">
                <i class="fa-solid fa-grid-2"></i> Dashboard
            </li>
            <li class="nav-item" onclick="switchTab('transactions')">
                <i class="fa-solid fa-receipt"></i> Transactions
            </li>
            <li class="nav-item" onclick="switchTab('insights')">
                <i class="fa-solid fa-chart-pie"></i> Insights
            </li>
            <li class="nav-item" onclick="switchTab('recommendations')">
                <i class="fa-solid fa-lightbulb"></i> Recommendations
            </li>
        </ul>
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color);">
            <div class="nav-item" style="color: var(--text-secondary);">
                <i class="fa-solid fa-gear"></i> Settings
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <header>
            <div style="display: flex; align-items: center;">
                <div class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fa-solid fa-bars"></i>
                </div>
                <div class="page-title">
                    <h1 id="page-header">Dashboard</h1>
                    <p>Welcome back! Here's your eco-update.</p>
                </div>
            </div>
            <div class="user-profile">
                <div style="text-align: right; display: none; @media(min-width: 600px){display:block;}">
                    <div style="font-weight: 600;">Alex Johnson</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">Eco Warrior</div>
                </div>
                <img src="https://picsum.photos/seed/ecoUser/100/100" alt="Profile" class="avatar">
            </div>
        </header>

        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <!-- Top Stats -->
            <div class="dashboard-grid">
                <div class="card stat-card">
                    <div class="stat-title">Total Emissions</div>
                    <div class="stat-value">204.26 <span style="font-size: 1rem; font-weight: 400; color: #6b7280;">kg CO₂e</span></div>
                    <div class="stat-sub trend-down"><i class="fa-solid fa-arrow-trend-down"></i> 22% vs National Avg</div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" style="width: 75%;"></div>
                    </div>
                    <div class="stat-sub" style="margin-top:5px;">This Month</div>
                </div>

                <div class="card stat-card">
                    <div class="stat-title">Sustainability Score</div>
                    <div class="stat-value">0/100</div>
                    <div class="stat-sub trend-neutral"><i class="fa-solid fa-triangle-exclamation"></i> Needs Improvement</div>
                    <div class="stat-sub" style="margin-top:auto;">Keep tracking to improve!</div>
                </div>

                <div class="card stat-card">
                    <div class="stat-title">Emission Intensity</div>
                    <div class="stat-value">0.0039</div>
                    <div class="stat-sub">kg CO₂e per $1 spent</div>
                    <div class="stat-sub" style="margin-top:auto;">Financial efficiency</div>
                </div>

                <div class="card stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div class="stat-title" style="color: rgba(255,255,255,0.8);">Quick Win</div>
                    <div style="font-size: 1.2rem; font-weight: 600; margin: 10px 0;">Switch to Renewable Energy</div>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 12px; border-radius: 8px; display: inline-block;">
                        Save <i class="fa-solid fa-leaf"></i> 0.10 kg CO₂e
                    </div>
                </div>
            </div>

            <div class="split-layout">
                <!-- Recent Transactions Preview -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                    <table class="transaction-table">
                        <thead>
                            <tr>
                                <th>Merchant</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Impact</th>
                            </tr>
                        </thead>
                        <tbody id="recent-tx-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    <button onclick="switchTab('transactions')" style="margin-top: 1rem; background: none; border: none; color: var(--primary-color); font-weight: 600; cursor: pointer;">View All Transactions &rarr;</button>
                </div>

                <!-- Categories Breakdown -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Emissions by Category</h3>
                    <div class="category-list" id="category-breakdown">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- TRANSACTIONS SECTION -->
        <section id="transactions" class="section">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3>All Transactions</h3>
                    <input type="text" placeholder="Search..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px;">
                </div>
                <table class="transaction-table">
                    <thead>
                        <tr>
                            <th>Merchant</th>
                            <th>Category</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>CO₂e Emission</th>
                        </tr>
                    </thead>
                    <tbody id="all-tx-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- RECOMMENDATIONS SECTION -->
        <section id="recommendations" class="section">
            <div class="split-layout">
                <div>
                    <h3 style="margin-bottom: 1rem;">Recommendations</h3>
                    <div class="rec-list">
                        <!-- High Priority -->
                        <div class="rec-item">
                            <div class="rec-left">
                                <div class="rec-icon rec-high"><i class="fa-solid fa-bolt"></i></div>
                                <div>
                                    <h4>Energy Efficiency Opportunity</h4>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">Switch to renewable energy provider for your home.</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge badge-high">High</span>
                                <div style="font-size: 0.9rem; font-weight: 600; margin-top: 4px;">-0.10 kg CO₂e</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Score: 85/100</div>
                            </div>
                        </div>

                        <!-- High Priority -->
                        <div class="rec-item">
                            <div class="rec-left">
                                <div class="rec-icon rec-high"><i class="fa-solid fa-train-subway"></i></div>
                                <div>
                                    <h4>Green Transport Options</h4>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">Consider train travel for your next commute.</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge badge-high">High</span>
                                <div style="font-size: 0.9rem; font-weight: 600; margin-top: 4px;">-0.27 kg CO₂e</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Score: 78/100</div>
                            </div>
                        </div>

                        <!-- Medium Priority -->
                        <div class="rec-item">
                            <div class="rec-left">
                                <div class="rec-icon rec-med"><i class="fa-solid fa-hand-holding-dollar"></i></div>
                                <div>
                                    <h4>Carbon Offset Plan</h4>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">Join a certified carbon offset program.</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge badge-med">Medium</span>
                                <div style="font-size: 0.9rem; font-weight: 600; margin-top: 4px;">-0.67 kg CO₂e</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Score: 72/100</div>
                            </div>
                        </div>

                        <!-- Low Priority -->
                        <div class="rec-item">
                            <div class="rec-left">
                                <div class="rec-icon rec-low"><i class="fa-solid fa-utensils"></i></div>
                                <div>
                                    <h4>Sustainable Dining</h4>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">Choose plant-based meals 1 day a week.</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span class="badge badge-low">Low</span>
                                <div style="font-size: 0.9rem; font-weight: 600; margin-top: 4px;">-0.08 kg CO₂e</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Score: 68/100</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Side Panel: Categories -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Top Emitters</h3>
                    <div class="category-list">
                        <div class="cat-item">
                            <div class="cat-info">
                                <h4><i class="fa-solid fa-plane" style="color: #3b82f6; margin-right:8px;"></i> Airlines</h4>
                                <span>3 Transactions</span>
                            </div>
                            <div style="text-align: right; font-weight: 700;">189.00 kg</div>
                        </div>
                        <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 90%; background-color: #3b82f6;"></div></div>

                        <div class="cat-item" style="margin-top: 1rem;">
                            <div class="cat-info">
                                <h4><i class="fa-solid fa-gas-pump" style="color: #ef4444; margin-right:8px;"></i> Fuel</h4>
                                <span>4 Transactions</span>
                            </div>
                            <div style="text-align: right; font-weight: 700;">6.72 kg</div>
                        </div>
                        <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 15%; background-color: #ef4444;"></div></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- INSIGHTS SECTION -->
        <section id="insights" class="section">
            <div class="insights-grid">
                <!-- Impact Card -->
                <div class="card impact-card">
                    <h3 style="margin-bottom: 1rem;">Your Environmental Impact</h3>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--text-main);">204.3 kg</div>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">CO₂e emitted this month</p>
                    
                    <div style="background: #ecfdf5; color: var(--primary-dark); padding: 10px; border-radius: 8px; display: inline-block; margin-bottom: 2rem;">
                        <i class="fa-solid fa-check-circle"></i> 22% lower than national average
                    </div>

                    <div class="tree-visual">
                        <i class="fa-solid fa-tree"></i>
                    </div>
                    <p>You need <strong>11 trees</strong> to offset this year's impact.</p>
                </div>

                <!-- Badges -->
                <div class="card">
                    <h3 style="text-align: center;">Achievement Badges</h3>
                    <div class="badges-container">
                        <div class="badge-achievement">
                            <div class="badge-icon"><i class="fa-solid fa-seedling"></i></div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Eco Starter</div>
                            <div style="font-size: 0.7rem; color: var(--text-secondary);">Tracked 1 month</div>
                        </div>
                        <div class="badge-achievement locked">
                            <div class="badge-icon" style="color: #9ca3af;"><i class="fa-solid fa-trophy"></i></div>
                            <div style="font-weight: 600; font-size: 0.9rem;">Green Champion</div>
                            <div style="font-size: 0.7rem; color: var(--text-secondary);">Locked</div>
                        </div>
                        <div class="badge-achievement locked">
                            <div class="badge-icon" style="color: #9ca3af;"><i class="fa-solid fa-bicycle"></i></div>
                            <div style="font-weight: 600; font-size: 0.9rem;">No Fly Zone</div>
                            <div style="font-size: 0.7rem; color: var(--text-secondary);">Locked</div>
                        </div>
                    </div>

                    <div class="trend-chart">
                        <h4 style="margin-bottom: 1rem;">Monthly Trend</h4>
                        <div class="chart-row">
                            <div class="chart-label">Oct</div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 40%; opacity: 0.6;"></div>
                            </div>
                            <div class="chart-value">40%</div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-label">Nov</div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 55%; opacity: 0.8;"></div>
                            </div>
                            <div class="chart-value">55%</div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-label">Dec</div>
                            <div class="chart-bar-bg">
                                <div class="chart-bar-fill" style="width: 75%;"></div>
                            </div>
                            <div class="chart-value">75%</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Data Model ---
        const transactions = [
            { id: 1, merchant: 'United Airlines', category: 'Travel', date: '2023-12-24', amount: 450.00, co2: 189.00 },
            { id: 2, merchant: 'Shell Gas Station', category: 'Fuel', date: '2023-12-22', amount: 45.50, co2: 3.20 },
            { id: 3, merchant: 'Whole Foods', category: 'Groceries', date: '2023-12-20', amount: 124.30, co2: 2.50 },
            { id: 4, merchant: 'Uber', category: 'Transport', date: '2023-12-18', amount: 24.00, co2: 3.52 },
            { id: 5, merchant: 'Chevron', category: 'Fuel', date: '2023-12-15', amount: 35.00, co2: 2.40 },
            { id: 6, merchant: 'Starbucks', category: 'Dining', date: '2023-12-14', amount: 12.50, co2: 0.45 },
            { id: 7, merchant: 'American Airlines', category: 'Travel', date: '2023-11-10', amount: 320.00, co2: 112.00 },
            { id: 8, merchant: 'Trader Joes', category: 'Groceries', date: '2023-11-05', amount: 85.20, co2: 1.80 },
        ];

        // --- Render Functions ---

        function getCo2Class(kg) {
            if (kg > 50) return 'co2-high';
            if (kg > 2) return 'co2-med';
            return 'co2-low';
        }

        function renderTransactions(containerId, limit = null) {
            const tbody = document.getElementById(containerId);
            tbody.innerHTML = '';
            
            const data = limit ? transactions.slice(0, limit) : transactions;

            data.forEach(tx => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div class="t-merchant">
                            ${tx.merchant}
                        </div>
                    </td>
                    <td><span class="t-category">${tx.category}</span></td>
                    <td>${tx.date}</td>
                    <td>$${tx.amount.toFixed(2)}</td>
                    <td>
                        <div class="t-co2 ${getCo2Class(tx.co2)}">
                            ${tx.co2.toFixed(2)} kg
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderCategories() {
            const container = document.getElementById('category-breakdown');
            const categories = {};
            
            // Aggregate data
            transactions.forEach(tx => {
                if (!categories[tx.category]) {
                    categories[tx.category] = { co2: 0, count: 0, icon: 'fa-tag' };
                }
                categories[tx.category].co2 += tx.co2;
                categories[tx.category].count += 1;
            });

            // Map icons
            const iconMap = {
                'Travel': 'fa-plane',
                'Fuel': 'fa-gas-pump',
                'Groceries': 'fa-basket-shopping',
                'Transport': 'fa-car',
                'Dining': 'fa-burger'
            };

            // Convert to array and sort
            const sortedCats = Object.entries(categories)
                .map(([name, data]) => ({ name, ...data, icon: iconMap[name] || 'fa-tag' }))
                .sort((a, b) => b.co2 - a.co2);

            // Render
            container.innerHTML = '';
            const maxCo2 = sortedCats[0].co2;

            sortedCats.forEach(cat => {
                const percent = (cat.co2 / maxCo2) * 100;
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="cat-item">
                        <div class="cat-info">
                            <h4><i class="fa-solid ${cat.icon}" style="margin-right:8px;"></i> ${cat.name}</h4>
                            <span>${cat.count} Transactions</span>
                        </div>
                        <div style="text-align: right; font-weight: 700;">${cat.co2.toFixed(2)} kg</div>
                    </div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: ${percent}%;"></div></div>
                `;
                container.appendChild(div);
            });
        }

        // --- Interaction Logic ---

        function switchTab(tabId) {
            // Update Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeNav = Array.from(document.querySelectorAll('.nav-item')).find(el => el.innerText.toLowerCase().includes(tabId));
            if (activeNav) activeNav.classList.add('active');

            // Switch Sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');

            // Update Header Title
            const titleMap = {
                'dashboard': 'Dashboard',
                'transactions': 'Transactions',
                'insights': 'Insights',
                'recommendations': 'Recommendations'
            };
            document.getElementById('page-header').innerText = titleMap[tabId];

            // Close sidebar on mobile after selection
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('open');
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderTransactions('recent-tx-body', 5);
            renderTransactions('all-tx-body');
            renderCategories();
        });

    </script>
</body>
</html>
